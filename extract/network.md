# 插件相关

## 功能相关

### 使用这个插件必须花钱吗？

如果你用默认配置，那么是需要的。你也可以选择自己搭建服务器或使用 colab 等，这些方案都是免费的。

## 网络相关

### 请求超时

如果偶尔发生无需在意。如果总是发生请尝试调高 `requestTimeout` 的数值或者配置 `proxyAgent`。

`proxyAgent` 设置的方式为

前往插件配置-全局设置-最下方的请求设置-使用的代理服务器地址-填入代理服务器地址-点击右上角的重载配置。

你要填入的内容为 `socks://ip:port` 例如 `socks://127.0.0.1:7890`。

### 未知错误 400 或 401

请确认 `type` 是否设置为 `token`。

将 `type` 切换成 `login` 后重载，再次切换成 `token` 重载可以解决此问题。

### 未知错误 403

通常是由权限问题导致的。请检查以下内容:

1. 你的 NovelAI 账户是否具有有效的付费计划
2. 你使用的 token 是否正确且未过期
3. 如果使用 login 方式，账号密码是否正确

如果使用的是第三方 API，请确保你有权限访问该服务。

### 未知错误 404

请确认 `endpoint` 是否正确，以及版本是否是最新。

如果你选择的 `type` 是 `sd-webui`，你还需确认你使用的 `sd-webui` 是来自于 `AUTOMATIC1111` 的版本，**且在启动时添加了 `--api` 参数**。

如果部署 sd-webui 与运行 koishi 的不是同一台电脑，且未通过隧道转发本地端口, 那么你还需要添加 `--listen` 参数。

### 未知错误 422

请更新插件版本。如插件版本已是最新，请尝试重置插件配置，并重新填写相应字段解决。

### 未知错误 429

这表示你的请求过于频繁，已被限流。请等待一段时间后再试，或减少请求频率。

对于官方 NovelAI API，可能是因为你的账户点数不足或超出了每日生成限额。

### 未知错误 500

请更新插件版本。如果更新后仍然出现，可能是服务器端的问题，请稍后再试。

### 未知错误 502

如果你选择的 `type` 是 `sd-webui`，且采用了公网转发的方式提供服务 (即在启动的时候传递了 `--share` 或 `--ngrok` 参数)，请确认你运行 `sd-webui` 的机器的网络情况，及与上述隧道服务的服务器的连通情况。

### 未知错误 503

如果你使用 NovelAI 官网作为后端 (`login` 或 `token`)，请尝试将 `endpoint` 中的 `api` 替换成 `backend-production-svc` 再试试。

### 图片生成失败问题排查

如果在生成图片过程中遇到问题，请按照以下步骤进行排查：

1. 检查网络连接是否稳定
2. 确认你的 API 设置是否正确（token、endpoint等）
3. 查看日志以获取更详细的错误信息
4. 如果使用 sd-webui，确保已正确安装并启动
5. 尝试生成更简单的提示词来排除复杂提示可能导致的问题

### 如何提高图像生成速度？

1. 减少步数（steps）参数，通常 20-30 步已经足够
2. 使用更小的图像分辨率
3. 如果使用本地部署的 SD-WebUI，确保你的 GPU 有足够的显存
4. 避免在高峰期使用 NovelAI 官方 API
5. 如果使用 SD-WebUI，可以尝试不同的采样器来平衡速度和质量

### NovelAI API 配额问题

如果你使用 NovelAI 官方 API，请注意以下配额限制：

1. **免费账户**：仅有非常有限的免费尝试次数
2. **Tablet 订阅**：每月有固定的点数分配用于图像生成
3. **Scroll 订阅**：获得更多点数和更高优先级
4. **Opus 订阅**：获得最多点数和最高优先级

当你的点数耗尽时，API 会返回错误。你可以在 NovelAI 网站上购买额外点数或等待下个月的点数刷新。

### 网络代理设置详解

如果你在中国大陆或其他需要代理才能访问 NovelAI 的地区，正确设置代理至关重要：

1. **HTTP代理**：`http://ip:port`
2. **SOCKS代理**：`socks://ip:port`
3. **带认证的代理**：`http://username:password@ip:port`

**检查代理是否生效**：
尝试简单的生成请求，如果收到响应而不是超时错误，则代理工作正常。

**常见代理问题**：
- 代理服务器无响应
- 代理格式错误
- 代理服务器屏蔽了 NovelAI 域名
- 代理速度过慢导致请求超时
