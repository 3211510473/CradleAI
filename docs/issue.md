剩余issue：按照优先级


1.朋友圈功能

转发；

点赞用户操作点赞/收藏/评论后，会重新加载页面，这是不必要的。

为界面创建一个收藏夹，用来存放所有用户收藏过的帖子，包含并同步帖子的状态。

朋友圈自己上传的图片可以打开

///角色认错人


2.摇篮系统

-因为characterscontext强制更新导致窗口退出的问题


-在生成图片时，如果用户添加标签，不要自动去除掉那些原始的标签，而是在原始标签存在的基础上增加，除非用户自己删除掉这些原始标签






3.关系系统


关系状态检视词，不要进行这样的约束：`这次发布可能的主题是：xxx`，而是角色根据自己的设定去创作


关系图片的画布中，应该用角色头像代表角色，而不是色块


而是角色根据自己的设定去创作



///角色回复时认错人的问题

4.聊天功能

-兼容html格式

-副ai状态栏和推进器

-用户名字username的赋值是通过设置页面，settingsidebar直接和nodestcore进行交互，为username赋值。并且提示在作者注释中加入user的文本宏设定以生效







5.我的

-页面只保留以下栏目
  -API设置；
  -加入社区（discord和加入qq群）；
  -关于（用默认文本占位）。

-保留清除角色数据按钮，这是测试环境使用的按钮。

-为页面顶部增加一个可以更换的头图来占位，背景默认defaultimage，以填补页面的空白。

-在API设置中，增加一个勾选"使用激活码"的选项，并且可输入激活码。暂不需业务逻辑，仅需UI/UX。



6.激活码体系

通过购买激活码，使用我的服务器进行消息转发和router配置


7.后端

测试账号轮询，以及准备账号

丢包处理

后端secretkey的安全性配置

NAI图片隐写术

将服务器地址替换成域名。




提示词的标签

openrouter方案定制化：

1.用户选择自己的偏好的输入输出回复字数，每日聊天的条数

2.用户输入自己每个月愿意固定付费的金额

3.由系统首先基于1来计算出用户每月消耗的token量，然后再参考用户愿意付费的金额，来计算一个推荐api搭配的方案，

4.如果涉及到免费模型使用，需要告知用户openrouter的免费速率限制：给出文档的链接








用户名字username的赋值是通过设置页面，settingsidebar直接和nodestcore进行交互，为username赋值。并且提示在作者注释中加入user的文本宏设定以生效

丢包处理

摇篮角色详情取消图像生成成功和失败的提示

生成的角色图片还未等展示完毕，就立刻跳转回了图像生成界面

允许生成图片的时候也选择画风参考

允许在创建角色和生成图片时自定义描述的提示词












7.UI fix



**当前UI问题:**

界面元素过多，信息层级不够清晰，操作按钮分散。

**设计原则:**

*   **视觉层次清晰：** 通过颜色、大小和间距来区分重要信息和次要信息。
*   **简化操作：** 将常用操作突出显示，不常用操作隐藏在菜单中。
*   **一致性：** 保持图标、颜色和排版的一致性。
*   **减少视觉噪音：** 移除不必要的元素，留出足够的空间。

**具体修改要求:**

**1. 顶部区域：**

*   保留 "摇篮系统" 作为主标题。
*   取消导入和设置按钮
*   取消“摇篮系统已启用” 状态指示器

**2. 角色卡详情页：**


*   角色名称保持突出。
*   角色状态（例如 "已生成"）使用更小、更微妙的视觉样式。
*   初始状态只显示角色描述的摘要，并提供 "展开" 链接以显示完整描述。
*   **操作按钮：**
    *   将 "生成图片"和"聊天" 设为主要操作按钮，视觉上突出。
    *   将 和"图库" 归类到  "..." 菜单中。
    *   将 "对话修改" 移动到 "..." 菜单中。
    *   将 "删除" 移动到 "..." 菜单中。

**4. 其他:**

*   确保整个APP使用一致的字体、颜色和图标。
*   调整元素的间距，使其看起来更整洁。


```

-UI修复重点在角色创建页面和摇篮页面

7.角色创建/详情页：

--提供预置preset条目，而不是现在这个默认条目配置

--头像放置在页面头图的左下角


8.角色卡页面

取消视图切换的按钮，只保留纵向排列的卡片视图。

取消角色创建按钮，因为在tab中已经有了创建

取消导出按钮





进程助手设置：

剧情推进助手是一种worldbook类条目的插入器。在开启它之后，每x次请求，会调用副ai来判断当前剧情推进状况

副ai使用和角色相同的preset



角色导入需要覆盖掉默认的preset条目



**目标：创建一个统一的角色创建模式，整合原“常规模式”和“摇篮模式”的功能。**

**核心思想：一个模式，多种组合，灵活选择。**

**最终结果：所有角色都将在 Cradle 页面被显示。**

**模式功能拆解：**

1.  **角色名称：** 用户统一创建。

2.  **角色设定 (角色的Json Data编辑)：**

    *   **默认 (手动编辑)：** 使用原“常规模式”的基本选项和高级选项 (编辑 rolecard, worldbook, preset, authornote)。
    *   **可切换 (AI 生成)：** 使用原“摇篮模式”的角色设定选项，通过 LLM (Gemini/Openrouter) 基于以下信息生成：
        *   角色性别
        *   用户性别
        *   角色年龄
        *   角色描述
        *   特征 Tag
        *   VNDB 检索结果
        *   **注意：此模式不参考图片 Tag，因为不再涉及服务器生成图片。**

3.  **角色外观：**

    *   **默认 (自主上传)：** 合并原“常规模式”和“摇篮模式”的自主上传功能，用户自行上传图片和头像。
    *   **可切换 (Tag 选择)：** 使用原“摇篮模式”的 Tag 选择图片功能。
    *   无论是用户上传的头像，还是AI生成的图片，确保它们能填充角色的avatar和backgroundimage
**组合情况总结：**

1.  **纯手动模式 (原“常规模式”)：** 所有内容由用户手动编辑，不需要调用API让LLM参与生成。
2.  **AI 图片 + 手动设定：** 使用服务端生成图片 (基于 Tag 选择)，但角色设定由用户手动编辑 (角色 jsondata 自己写)。此模式不需要调用 LLM 进行写作。
3.  **手动图片 + AI 设定：** 用户自主上传图片，但角色设定由 LLM 生成 (基于角色/用户性别、角色年龄、角色描述、特征 Tag 和 VNDB 检索结果)。
4.  **纯 AI 模式 (原“摇篮模式”)：** 角色设定和图片内容全部由 AI 生成。






