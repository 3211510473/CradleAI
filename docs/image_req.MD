好的，以下是整合了您的原始提示词和新增功能的更全面的任务列表：

**目标：**

优化角色图库，增加强大的图片编辑功能，使用户可以对角色图库中的图片进行编辑和修改，并将修改后的图片保留在角色图库中。目标是降低创作门槛，激发创作灵感，并提供更有趣、更强大的功能。

**详细任务：**

1.  **学习 Gemini 图像编辑功能：**

    *   阅读 `gemini-image-guide.md`，深入理解如何使用 Gemini API 进行图片编辑，包括所有计划实现的功能。

2.  **设计用户界面 (角色图库)：**

    *   在角色图库中添加图片编辑按钮，允许用户选择要编辑的图片。
    *   设计清晰直观的界面，方便用户使用各种编辑功能。

3.  **图片编辑功能实现：**

    *   用户在编辑界面可以对图片进行修改，并具有以下选项：

        *   **角色元素修改 (局部重绘):**
            *   提供修改角色身体特定元素的选项，并进一步细化到眼睛、鼻子、嘴巴等具体部位
            *   构建用户选项与 Gemini 提示词之间的映射关系。
        *   **图片背景替换:**
            *   允许用户输入希望替换的背景描述。
            *   将用户输入的背景描述转换为 Gemini 提示词。
        *   **图片风格转绘:**
            *   预置适合二次元角色扮演的多种风格 (例如像素风格、水彩风格)。
            *   构建风格选项与 Gemini 提示词之间的映射关系。
        *   **自定义输入:**
            *   允许用户完全自定义 Gemini 提示词，自由控制图片编辑。
        *   **负面提示词:**
            *   允许用户指定不希望出现在图片中的元素，例如“不要出现文字”、“避免模糊”等。
            *   将负面提示词合并到最终的 Gemini 提示词中。
        *   **角色姿势调整:**
            *   允许用户选择预设的姿势模板。
            *   考虑使用拖拽关键点的方式，让用户更自由地调整角色姿势。
            *   可以结合骨骼动画技术，实现更自然的姿势控制 (如果可行)。
        *   **服装/配饰生成:**
            *   让用户描述想要的服装/配饰的风格、颜色、材质等。
            *   构建选项与 Gemini 提示词之间的映射关系。
        *   **表情生成:**
            *   根据用户输入的文字，让角色呈现出不同的表情，例如微笑、惊讶、愤怒等。
            *   将文字描述转换为 Gemini 提示词，控制角色的表情变化。
        *   **场景生成:**
            *   允许用户提供角色信息和场景描述。
            *   自动生成包含该角色在指定场景中的完整图片。考虑提供预设的场景选项。
        *   **角色联动 (限制两个):**
            *   允许用户将多个角色图库中的角色组合到同一张图片中，创造角色互动的场景。
            *   限制最多选择两个角色，以避免图片生成效果不佳。

4.  **Gemini API 集成：**

    *   使用 `Gemini-adapter.ts` 发送编辑请求到 Gemini API。
    *   处理 Gemini API 的响应，获取编辑后的图片。
    *   实现错误处理机制，应对 API 请求失败或其他异常情况。

5.  **图片管理：**

    *   为用户提供选择是否保留编辑后图片的功能。
    *   如果用户选择保留，将编辑后的图片显示在角色图库中。
    *   考虑提供图片版本管理功能，允许用户回退到之前的编辑状态。

**关键点：**

*   **提示词工程：**  所有功能都依赖于高质量的提示词。 需要仔细设计提示词模板，并确保用户输入能够正确地转换为有效的提示词。
*   **用户体验：**  简化操作流程，提供实时预览，确保用户可以轻松地使用各种编辑功能。
*   **性能优化：**  对图片处理和 API 请求进行性能优化，以提供流畅的用户体验。 特别是角色联动、场景生成等功能，可能需要更高效的算法。
