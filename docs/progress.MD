2025/3/31


当前，app端的功能，除了一些小bug之外，已经完成；现在进行serverless后端的重新搭建，摒弃旧的存储方式。生图服务摒弃NAI，选择replicate，实现真正的按使用量计费。

serverless：客户端-存储端-函数服务端

客户端-函数端：请求申请

函数端-函数端：license验证

函数端-API端：请求执行和返回

函数端-存储端：文件存储

存储端-客户端：文件返回。







朋友圈问题


   -角色发帖频率和朋友圈页面的联动问题
   
   -允许用户和角色在朋友圈中进行多轮互动。在多轮互动中，角色的回复必须参考的当前所在朋友圈的所有历史回复内容，以确保上下文的连续性。多轮互动适用于：

       -用户回复角色的朋友圈时

       -角色回复用户的朋友圈时

       -用户和角色，在其他角色的朋友圈评论区，进行互相回复时
 
    -角色回复时需要参考自己Character对象的jsonData属性，该属性是一个json对象，包含了角色的人物设定信息。


TTS问题

轮询机制的问题：

1.轮询：

如果没有收到后端响应，则发送一个post请求，期望查看当前任务的运行状态，如果服务端返回failed，则宣告任务失败。如果为waiting/starting/processing，则间隔30秒之后再Post询问一次。连续Post询问三次，无succeed结果，才最终宣告任务失败。

2.如果后端收到完全一样的请求体，首先检查prediction是否还在运行中，如果是，那么等到这个prediction完毕后，再返回结果，而不是再创建一个prediction；如果缓存中存在和该请求体对应的响应，则直接返回缓存的响应








其他问题

硬编，内存泄漏等问题（角色卡删除的数据同步）


9.退出app后memoryfact丢失的问题。-



10.云服务：openrouter的转发，图片，tts的价格的问题。-


  -首先在模型计算器中，选择自己的使用习惯，需要更新对声音和图片的需求，计算出每个月的价格（充值+服务器费用）





画风参考和tag的实用性问题。




网站联系信息和售后


6.app打包



新增角色类型定义：动态立绘

功能入口：

1.摇篮页面-角色图库中，增加选项卡，可添加动态立绘

2.动态立绘可从手机相册选择，或在当前图库中选择。

3.顺便让现在的角色图库中的静态图片，也支持从手机上传图片。

动态立绘画

添加动态立绘的第一步是上传图片到cd r2存储桶

理解r2存储桶的上传规则，编写相应代码。

成功上传后，将图片的url地址发送给replicate后端

等待replicate返回视频的url，并下载。




replicate：

-新增图生视频接口，接收前端发送的r2 url

-前端传入图片将上传到cd r2存储桶，

-首帧和尾帧都是同一个图片url，因为我们需要的是动态立绘

-新增一个luma ai的调用，传入首尾帧

-返回视频url，前端需下载到本地

-编写测试脚本，测试图生视频服务是否可用

-前端做好缓存清理。









在聊天界面展示动态立绘

聊天记录后处理，根据聊天上下文和当前ai回复输出，立绘类型，以及下一步剧情建议，Json输出

聊天界面展示可以切换(视觉小说模式或常规模式)，视觉小说模式需要消息区域设置一个边界线，靠近这个边界线的消息条的边缘会渐变透明，这样就可以让边界线上方的背景不被消息条遮挡。

主动消息也需要加入后处理，在用户打开窗口时自动播放动态立绘(如果在动态立绘模式normal~conditional
